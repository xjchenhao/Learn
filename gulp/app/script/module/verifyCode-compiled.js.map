{"version":3,"sources":["verifyCode.js"],"names":[],"mappings":"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","file":"verifyCode-compiled.js","sourcesContent":["/*验证码倒计时,带ajax请求 1.2.5*/\n\n(function (root, factory) {\n    if (typeof define === 'function' && (define.amd || define.cmd)) {\n        define(function (require, exports, module) {\n            require('zepto');\n            var cookie = require('module/cookie');\n            var rsaEncrypt = require('module/rsaEncrypt');\n            var encryptedPwd = rsaEncrypt('10001', '9d183e5918a188d09ead235a4c2dc54e5216281d4a72fa57d21cf736d445d60591ba794c201efcf3f98bb3553a314f84d6b4af92dd400da34c2d9ad65baca2e7b329bf5320fa2e5790f91ab79a492d0b75ce1a6fa60dc8ab5399dd7e61632284e42aee9b33596b06ee2c256d0ef819e6f64378d33d0d9cfd5fa4462880e1ebd9');\n\n            return factory(root, exports, cookie, encryptedPwd);\n        });\n    } else {\n        root.btnLight = factory(root);\n    }\n})(this, function (root, exports, cookie, encryptedPwd) {\n\n    //常量\n    var BTNTEXT = '获取验证码',             //可获取验证码的状态按钮上文字\n        WAITTEXT = '秒后重新获取',          //倒计时中按钮上文字\n        URL = '/wap/user/validCode.html',   //请求地址\n        WAITTIME = 60,                      //倒计时时间\n        DISIABLEDCLASS = 'disabled',  //倒计时中的状态样式\n        SHOWCLASS = 'red',           //可获取验证码的状态样式\n        PHONECOOKIE = 'phoneCookie',\n\n    //0-下面这两项要配(ajax的返回值)，一个是键，一个是值,请求超时时间，一个是请求失败提示文字\n        AJAXTITLE = 'resultCode',\n        AJAXYES = 1,\n        AJAXNO = 0,\n\n        TIMEOUT = 5000,\n        WARNING = '网络繁忙，请稍后再试！';\n\n    var verifyCode = function (obj) {\n\n        obj = obj || {};\n\n        this.elmInput = obj.elmInput;\n        this.elmBtn = obj.elmBtn;\n        this.data = obj.data || {};\n        this.url = obj.url || URL;\n        this.time = obj.time || WAITTIME;\n        this.isInstant = obj.isInstant || false;\n        this.timeCookie = obj.timeCookie || 'verifyCodeTime';\n        this.phoneKey = obj.phoneKey || 'userName';\n        this.timer = null;\n        this.timeStartCallback=obj.timeStartCallback;\n        this.timeEndCallback=obj.timeEndCallback;\n\n        this.disabledClass = DISIABLEDCLASS;\n        this.showClass = SHOWCLASS;\n        this._init();\n        this._handle();\n    };\n\n\n    verifyCode.prototype._init = function () {\n        if(cookie.getCookie(self.timeCookie)){\n            this._timeUpdate();\n        }\n\n        //todo:不影响这个项目的bug,它会拿cookie的手机号替换掉a页面传过来的值.\n        //if(cookie.getCookie(PHONECOOKIE)){\n        //    this.elmInput.value = cookie.getCookie(PHONECOOKIE);\n        //}\n    };\n    verifyCode.prototype._handle = function () {\n        var self = this;\n        self._event = {\n            getValidNum: function () {\n                var phoneKey = {};\n                phoneKey[self.phoneKey] = encryptedPwd(self.elmInput.value);\n                $.ajax({\n                    url: self.url,\n                    data: $.extend(self.data, phoneKey),\n                    dataType: 'json',\n                    type: 'post',\n                    beforeSend: function () {\n                        self.elmBtn.setAttribute('disabled',true);\n                    },\n                    success: function (data) {\n                        if (data[AJAXTITLE] == AJAXYES) {\n                            cookie.setCookie(self.timeCookie, self.time, self.time);\n                            cookie.setCookie(PHONECOOKIE, null, -1);\n                            cookie.setCookie(PHONECOOKIE, self.elmInput.value, 86400);\n                            self._timeUpdate();\n                        } else if (data[AJAXTITLE] == AJAXNO) {\n                            alert(WARNING);\n                        }\n                    },\n                    error:function(){\n                        self.timeEndCallback && self.timeEndCallback();\n                    }\n                });\n            }\n        };\n\n\n\n        if(self.isInstant){\n            if(cookie.getCookie(self.timeCookie)){\n                self._timeUpdate();\n            }else{\n                self._event.getValidNum();\n            }\n        }\n        self.elmBtn.addEventListener('click', self._event.getValidNum, false);\n    };\n    verifyCode.prototype.run=function(){\n        this._event.getValidNum()\n    };\n    verifyCode.prototype.destroy = function () {\n        var self = this;\n        this.elmBtn.removeEventListener('click', self._event.getValidNum, false);\n        window.clearTimeout(self.timer);\n        self.timer = null;\n    };\n    verifyCode.prototype._timeUpdate = function () {\n        var self = this,\n            btn = self.elmBtn,\n            time = Number(cookie.getCookie(self.timeCookie));\n\n        self.timeStartCallback && self.timeStartCallback();\n\n        if (time === 0) {\n            cookie.setCookie(self.timeCookie, null, -1);\n            btn.removeAttribute(\"disabled\");\n            self._removeClass(btn, self.disabledClass);\n            self._addClass(btn, self.showClass);\n            btn.value = BTNTEXT;\n            self.timeEndCallback && self.timeEndCallback();\n        } else {\n            self.elmBtn.setAttribute(\"disabled\", true);\n            self._addClass(btn, self.disabledClass);\n            self._removeClass(btn, self.showClass);\n            btn.value = time + WAITTEXT;\n            time--;\n            cookie.setCookie(self.timeCookie, time, time);\n            self.timer = setTimeout(function () {\n                self._timeUpdate();\n            }, 1000);\n        }\n    };\n    verifyCode.prototype._addClass = function (obj, cls) {\n        var targetObj = this.isErrorOnParent ? obj.parentElement : obj;\n        if (typeof cls == 'string' && targetObj.nodeType === 1) {\n            if (!targetObj.className) {\n                targetObj.className = cls;\n            } else {\n                var a = (targetObj.className + ' ' + cls).match(/\\S+/g);\n                a.sort();\n                for (var i = a.length - 1; i > 0; --i)\n                    if (a[i] == a[i - 1]) a.splice(i, 1);\n                targetObj.className = a.join(' ');\n            }\n        }\n    };\n    verifyCode.prototype._removeClass = function (obj, cls) {\n        var targetObj = this.isErrorOnParent ? obj.parentElement : obj;\n        if (targetObj.className && typeof cls === 'string' && targetObj.nodeType === 1) {\n            var classArr = targetObj.className.split(' ');\n            for (var i = 0, iLength = classArr.length; i < iLength; i++) {\n                if (classArr[i] === cls) {\n                    classArr.splice(i, 1);\n                }\n            }\n            targetObj.className = classArr.join(' ');\n        }\n    };\n\n\n    return verifyCode;\n});"]}