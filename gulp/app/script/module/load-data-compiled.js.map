{"version":3,"sources":["load-data.js"],"names":[],"mappings":"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","file":"load-data-compiled.js","sourcesContent":["/*数据加载 1.0.3*/\n(function (root, factory) {\n    if (typeof define === 'function' && (define.amd || define.cmd)) {\n        define(function (require, exports, module) {\n            require('zepto');\n            var Event = require('module/event');\n            var Infinite = require('module/infinite');\n            var status = require('module/load-data-status');\n            return factory(root, Event, Infinite, status);\n        });\n    } else {\n        root.LoadDate = factory(root);\n    }\n})(this, function (root, Event, Infinite, status) {\n    // 分页接口（这里需要配置）\n    var PAGE = 'currentPage', // 当前页\n        ROWS = 'resultData.total', // 条数\n        PAGE_COUNT = 'resultData.pages';// 分页总数\n\n    // 类名常量\n    var classPrefix = 'ui-load-';\n\n    // 生成类名对象\n    var CLASS = (function () {\n        return {\n            CONTAINER: classPrefix + 'container',\n            CONTENT: classPrefix + 'content',\n            LOADING_BG: classPrefix + 'bg'\n        };\n    }());\n\n\n    var _eventId = 0,   // new出多个实例时保证每个实例事件的独立性\n        currentPage = 1;  // 请求页码\n\n\n    var LoadDate = function (opts) {\n        var DEFAULT = {\n            url: '', // 接口地址(必须)\n            container: '', // load-container 容器对象(必须)\n            tpl: '', // 可以是模板路径或者是要解析的字符串(必须)\n            noListStr: '暂无记录', // 无记录时，显示的文本(缺省)\n            sendData: {}, // 默认发送的data数据(缺省)  去除了page :1，不可为null\n            pageType: 'none', // 分页类型(缺省)\n            tplFn: null,   // 传入data解析成html函数\n            callback: null   // 载入完成后的回调函数(缺省)(用于绑定事件，注意尽量事件委托，并注意先off，免得重复绑定)\n        };\n        this._config = $.extend({}, DEFAULT, opts);\n        this._init();\n        this._load();\n    };\n\n    LoadDate.prototype._init = function () {\n        var config = this._config;\n\n        // 设置命名空间\n        this._eventId = ++_eventId;\n\n        // 保证容器对象是jquery对象\n        config.container = typeof config.container === \"object\" ? config.container : $(config.container);\n\n        // 添加数据列表容器\n        config.container.addClass(CLASS.CONTAINER).html('<div class=\"' + CLASS.CONTENT + '\"></div>');\n\n        //添加事件订阅\n        this._addEvent();\n\n    };\n\n    LoadDate.prototype._load = function () {\n        var self = this,\n            config = self._config,\n            eventId = self._eventId;\n\n        // 给容器添加加载中class\n        config.container.addClass(CLASS.LOADING_BG);\n\n        // 生成加载中状态\n        Event.trigger('loading.' + eventId);\n\n        $.ajax({\n            url: config.url,\n            async: true,\n            data: config.sendData,\n            dataType: 'json',\n            type: 'POST',\n            xhrFields: {\n                withCredentials: true\n            },\n            success: function (data) {\n                var html;\n\n                if (!getObjVal(data, ROWS) || getObjVal(data, ROWS) <= 0) {\n                    Event.trigger('noData.' + eventId);\n                    return;\n                }\n\n                html = config.tplFn(data);\n\n                Event.trigger('hasData.' + eventId, data, html);\n            },\n            timeout: 10000,\n            error: function () {\n                Event.trigger('fail.' + eventId);\n            }\n        });\n    };\n    LoadDate.prototype._addEvent = function () {\n        var self = this,\n            eventId = self._eventId,\n            config = self._config,\n            container = config.container,\n            content = container.children('.' + CLASS.CONTENT),\n            callback = config.callback;\n\n        // 有数据,添加dom\n        Event.one(\"hasData.\" + eventId, function (data, html) {\n            removeStatus();\n            content.html(html);\n            currentPage++;\n            callback && callback.call(null, true, data);\n        });\n\n        // 有数据,挂载下拉加载事件\n        Event.one(\"hasData.\" + eventId, function (data, html) {\n            var infinite = new Infinite({\n                box: config.container.parent()[0],\n                con: config.container[0],\n                callback: function () {\n                    var isLoading = false,\n                        currentPageObj={};  // $.extend里直接写对象的话,常量变成普通的字面量输出了,所以先在外面生成对象再放进去\n\n                    currentPageObj[PAGE]=currentPage;\n                    $.ajax({\n                        url: config.url,\n                        type: \"post\",\n                        dataType: \"json\",\n                        data: $.extend(config.sendData, currentPageObj),\n                        async: false,\n                        xhrFields: {\n                            withCredentials: true\n                        },\n                        success: function (data) {\n\n                            // 超出总页数\n                            if (currentPage > getObjVal(data, PAGE_COUNT)) {\n                                return false;\n                            }\n\n                            currentPage++;\n                            var html = config.tplFn(data);\n                            content.append(html);\n                            isLoading = true;\n                        }\n                    });\n                    return isLoading;\n                }\n            });\n        });\n\n        // 无数据\n        Event.one(\"noData.\" + eventId, function () {\n            removeStatus();\n            var noListStr = config.noListStr;\n            status.noData(content, noListStr);\n            callback && callback.call(null, false);\n        });\n\n        // 出错\n        Event.one(\"fail.\" + eventId, function () {\n            removeStatus();\n            var reLoad = bind(self._load, self);\n            status.again(content, reLoad);\n        });\n\n        // 加载中\n        Event.one(\"loading.\" + eventId, function () {\n            status.loading.show(content);\n        });\n\n        function removeStatus() {    // 初始化,移除容器的各种状态\n            status.removeNoData(content);\n            status.loading.hide(content);\n            container.removeClass(CLASS.LOADING_BG);\n        }\n    };\n\n    LoadDate.prototype.destroy = function () {\n    };\n\n    return LoadDate;\n\n    // Helper\n    // 绑定作用域\n    function bind(fn, context) {\n        if (arguments.length < 2 && context === undefined) return fn;\n        var method = fn,\n            slice = Array.prototype.slice,\n            args = slice.call(arguments, 2);\n        return function () { // 这里传入原fn的参数\n            var array = slice.call(arguments, 0);\n            return method.apply(context, args.concat(array));\n        };\n    }\n\n    function getObjVal(obj, str) {\n        var val = obj,\n            valArr = str.split('.');\n        for (var i = 0, l = valArr.length; i < l; i++) {\n            val = val[valArr[i]];\n        }\n        return val;\n    }\n});"]}